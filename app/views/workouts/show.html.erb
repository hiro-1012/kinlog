<div class="container mt-4" data-controller="workout-form">
  <div class="row">
    <div class="col-12 col-lg-8 mx-auto">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="h3 mb-0"><%= @workout.performed_on.strftime('%Y年%m月%d日') %> の記録</h2>
        <%= link_to '一覧へ戻る', workouts_path, class: 'btn btn-outline-secondary btn-sm' %>
      </div>
      <p class="text-muted">合計ボリューム: <strong><%= @workout.total_volume.to_i %> kg</strong></p>

      <% if user_signed_in? && @workout.user == current_user %>
        <div class="mb-4 text-end">
          <%= link_to 'セットを追加', new_workout_exercise_set_path(@workout), class: 'btn btn-primary' %>
        </div>
      <% end %>

      <% if @exercise_sets.any? %>
        <% @exercise_sets_by_category.each do |category, sets| %>
          <div class="card mb-4">
            <div class="card-header bg-light d-flex justify-content-between align-items-center">
              <span><%= category.name %></span>
              <small class="text-muted">合計ボリューム: <strong><%= (sets.sum { |s| s.weight.to_f * s.reps.to_i }).to_i %> kg</strong></small>
            </div>
            <div class="table-responsive">
              <table class="table table-striped mb-0">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>種目</th>
                    <th>重量</th>
                    <th>回数</th>
                    <th>ボリューム</th>
                    <th>メモ</th>
                    <% if user_signed_in? && @workout.user == current_user %>
                      <th>操作</th>
                    <% end %>
                  </tr>
                </thead>
                <tbody>
                  <% sets.each_with_index do |s, i| %>
                    <tr>
                      <td><%= i + 1 %></td>
                      <td><%= s.exercise.name %></td>
                      <td><%= s.weight %> kg</td>
                      <td><%= s.reps %> 回</td>
                      <td><strong><%= (s.weight * s.reps).to_i %> kg</strong></td>
                      <td><%= s.note %></td>
                      <% if user_signed_in? && @workout.user == current_user %>
                        <td>
                          <%= link_to '削除', workout_exercise_set_path(@workout, s), 
                              method: :delete, 
                              class: 'btn btn-outline-danger btn-sm',
                              data: { confirm: 'このセットを削除しますか？' } %>
                        </td>
                      <% end %>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          </div>
        <% end %>
      <% else %>
        <div class="card">
          <div class="card-body text-center text-muted py-4">
            まだセットが記録されていません
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>